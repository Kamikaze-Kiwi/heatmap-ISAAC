<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/maps/modules/map.js"></script>
<script src="http://code.highcharts.com/maps/modules/data.js"></script>
<script src="https://rawgithub.com/paulo-raca/highcharts-contour/master/highcharts-contour.js"></script>
<script src="https://rawgithub.com/ironwallaby/delaunay/master/delaunay.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<div class="d-flex justify-content-center">
  <h1 id="selectedDateTime"></h1>
</div>

<div id="container" style="height: 80%; width: 80%; margin: 0 auto"></div>

<script>
  var chart = Highcharts.chart('container', {
    data: {
      rows: [['x', 'y', 'Temperature'],
      [0, 0, 0],
      [0, 14, 0],
      [32, 0, 0],
      [32, 14, 0]]
    },
    chart: {
      type: 'contour',
      inverted: false,
      plotBackgroundImage: 'derde-verdieping.svg'
    },
    title: {
      text: null
    },
    accessibility: {
      point: {
        descriptionFormatter: function (point) {

        }
      }
    },
    tooltip: {
      formatter: function () {
        return this.point.value + ' Â°C';
      }
    },
    yAxis: {
      minPadding: 0,
      maxPadding: 0,
      startOnTick: false,
      endOnTick: false,
      visible: false,
      reversed: true,
      labels: {
        enabled: false
      },
      title: {
        text: null
      },
    },
    xAxis: {
      minPadding: 0,
      maxPadding: 0,

      startOnTick: false,
      endOnTick: false,
      tickLength: 0,
      labels: {
        enabled: false
      }
    },
    colorAxis: {
      stops: [
        [0.00, 'rgba(0,0,250,0.5)'],
        [0.24, 'rgba(0,250,250,0.5)'],
        [0.33, 'rgba(0,250,0,0.5)'],
        [0.50, 'rgba(250,250,0,0.5)'],
        [0.80, 'rgba(250,0,0,0.5)']
      ],
      min: 10,
      max: 40
    },
    series: [{
      borderWidth: 0
    }]
  });
</script>

<script>
  let selectedDayData = [{sensors: [{x: Number, y: Number, temperature: Number}]}];

  let dateTimeText = document.getElementById('selectedDateTime');

  //getDataByDay(new Date());

  function getDataByDay(datetime) {
    dateTimeText.innerText = datetime.toLocaleDateString() + ' ' + datetime.toLocaleTimeString();

    fetch('http://google.com?' + new URLSearchParams({
      dateTime: datetime.toISOString()
    }),{
      method: 'GET'
    })
    .then(response => console.log(response))
    .then(data => console.log('success: ' + data))
    .catch((error) => {
      console.log('error: ' + error)
    })

    updateHeatmapByTime(datetime);
  }



  function updateHeatmapByTime(index){

    //TEMPORARY
    let mockData = [
      {
        "sensors": [
          {
            "x": 0,
            "y": 0,
            "temperature": 40
          },
          {
            "x": 0,
            "y": 14,
            "temperature": 40
          }, 
          {
            "x": 32,
            "y": 0,
            "temperature": 10
          },
          {
            "x": 32,
            "y": 14,
            "temperature": 10
          }
        ]
      },
      {
        "sensors": [
          {
            "x": 0,
            "y": 0,
            "temperature": 10
          },
          {
            "x": 0,
            "y": 14,
            "temperature": 20
          },
          {
            "x": 32,
            "y": 0,
            "temperature": 30
          },
          {
            "x": 32,
            "y": 14,
            "temperature": 40
          }
        ]
      }
    ]
    //TEMPORARY

    //let currentData = selectedDayData[index];
    let currentData = mockData[index];

    let parsedData = [['x', 'y', 'Temperature']];
    currentData.sensors.forEach(sensor => {
      parsedData.push([sensor.x, sensor.y, sensor.temperature])
    });

    console.log(parsedData);

    chart.series[0].update({
      data: parsedData
    })
  }

</script>